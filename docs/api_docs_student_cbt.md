# Student CBT API Documentation

**Base URL**: `/api/assessments`
**Authorization**: Bearer Token (Student Role)

## 1. Get Assessment Details
**Endpoint**: `GET /assessments/:id`
**Description**: Fetches assessment metadata (title, instructions, timing) and questions (if allowed).
**Use Case**: Displaying the "Exam Lobby" and the exam questions itself.

### Response
```json
{
  "id": "cm...",
  "title": "Mathematics Mid-Term",
  "instructions": "Answer all questions",
  "durationMins": 60,
  "startsAt": "2024-03-20T09:00:00Z",
  "endsAt": "2024-03-20T12:00:00Z",
  "isPublished": true,
  "questions": [
    {
      "id": "q1",
      "type": "MCQ",
      "prompt": "What is 2 + 2?",
      "marks": 1,
      "choices": [
        { "id": "c1", "text": "3" },
        { "id": "c2", "text": "4" }
      ]
    }
  ]
}
```

---

## 2. Start Assessment
**Endpoint**: `POST /assessments/:id/start`
**Description**: Initializes the server-side attempt. **Crucial for the timer.**

### Request Body
```json
{
  "startedAt": "2024-03-20T09:05:00Z", // Optional, defaults to server time
  "deviceMeta": {
    "browser": "Chrome 120",
    "os": "Windows 11",
    "ip": "1.2.3.4"
  }
}
```

### Response
```json
{
  "submissionId": "sub_123...",
  "status": "in_progress",
  "startedAt": "2024-03-20T09:05:00Z",
  "deadline": "2024-03-20T10:05:00Z" // Calculated deadline (start + duration)
}
```

---

## 3. Submit Assessment
**Endpoint**: `POST /assessments/:assessmentId/submissions`
**Description**: Final submission of answers.

### Request Body
```json
{
  "startedAt": "2024-03-20T09:05:00Z",
  "finishedAt": "2024-03-20T10:00:00Z",
  "deviceMeta": { "browser": "..." },
  "antiMalpracticeData": {
    "tabSwitchCount": 2,
    "windowBlurCount": 1,
    "suspiciousActivity": ["Focus lost at 09:10"]
  },
  "answers": [
    {
      "questionId": "q1",
      "value": { "selected": "c2" } // For MCQ/TrueFalse (Choice ID)
    },
    {
      "questionId": "q2",
      "value": "My essay answer..." // For Theory (String)
    }
  ]
}
```

---

## 4. Offline Sync
**Endpoint**: `POST /assessments/offline-submissions/sync`
**Description**: Syncs submissions stored locally when internet was down.

### Request Body
```json
{
  "submissions": [
    {
      "clientSubmissionId": "frontend-uuid-1", // Unique ID generated by frontend
      "assessmentId": "cm...",
      "startedAt": "...",
      "finishedAt": "...",
      "answers": [...],
      "deviceMeta": { ... }
    }
  ]
}
```
